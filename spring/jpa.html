<!DOCTYPE html>
<html lang="en">
<head>
    <title>JPA</title>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="../js/styles.css"/>
</head>
<body data-sidebar="spring">
<nav>
    <button class="mobile-sidebar-btn" id="mobileSidebarBtn">☰</button>
    <div class="breadcrumbs">
        <a href="../home.html">Home</a>
        <span class="separator">/</span>
        <a href="#">Spring</a>
        <span class="separator">/</span>
        <a href="#">JPA</a>
    </div>
</nav>
<!-- Components will be inserted here by components.js -->

<!-- Main Content Section -->
<main id="content">
    <h3>1. ORM (Object-Relational Mapping):</h3>

    <ul>
        <li>A technique to connect object-oriented Java applications with relational databases.</li>
        <li>Allows performing database operations (CRUD) in an object-oriented manner (save object, update object,
            etc.).
        </li>
    </ul>

    <p><b>Advantages of JPA:</b></p>

    <ul>
        <li><strong>Database Independent</strong>: Code works across different databases (requires changing dialect).
        </li>
        <li><strong>Easy Development</strong>: Queries are often generated automatically; custom queries can be written
            using JPQL (Java Persistence Query Language) or HQL (Hibernate Query Language), which use class/variable
            names instead of table/column names.
        </li>
        <li><strong>Data Type Independence</strong>: Handles mapping between Java and database data types.</li>
    </ul>

    <hr>

    <h3>2. Spring Data JPA Repositories</h3>

    <ul>
        <li>Provides predefined interfaces (<strong>CrudRepository</strong>, <strong>PagingAndSortingRepository</strong>,
            <strong>JpaRepository</strong>) to simplify database operations.
        </li>
        <li>Programmers extend these interfaces, and Spring Data JPA automatically generates implementation classes at
            runtime for common CRUD operations.
        </li>
        <li>JpaRepository is the most commonly used, extending the others.</li>
    </ul>

    <p><b>1. Predefined Methods in Repository Interfaces:</b></p>

    <ul>
        <li>save(), delete(), findById(), findAll(), count(), existsById(), findAll(Sort), findAll(Pageable).</li>
    </ul>

    <p><b>2. Entity Class and Common Annotations:</b></p>

    <p>A Java class mapped to a database table.</p>

    <p>@Entity: Maps the class to a table (must-have).</p>

    <p>@Table: (Optional) Specifies table details.</p>

    <p>@Id: Marks the primary key field (must-have).</p>

    <p>@Column: (Optional) Specifies column details.</p>

    <p>@GeneratedValue: For auto-generating ID values.</p>

    <p><b>3. Naming Convention for Finder Methods (Spring Data JPA):</b></p>

    <p>Custom query methods are automatically derived from method names following a pattern:
        findBy&lt;VariableName&gt;&lt;Keyword&gt;.</p>

    <p>Example: findByLastName(String lastName) generates a WHERE clause based on the
        lastName variable.</p>

    <ol>
        <li>Creating a Custom Repository:</li>
    </ol>

    <p>Create an interface that extends Repository, CrudRepository, PagingAndSortingRepository, or
        JpaRepository.</p>

    <p>JpaRepository is generally preferred for relational databases.</p>

    <hr>

    <h3>3. @Query Annotation:</h3>

    <p>A native query lets you write plain SQL (specific to your database) instead of JPQL (Java
        Persistence Query Language).</p>

    <p>This is useful when:</p>
    <ul>
        <li>You need database-specific features</li>
        <li>You want better performance for complex queries</li>
        <li>You can't express something easily using JPQL</li>
    </ul>

    <ul>
        <li>Non-Select Operations: For UPDATE or DELETE queries, @Query must be combined with
            @Modifying.
        </li>
    </ul>

    <pre class="java-code">
<code>
<span class="keyword">public interface</span> <span class="class">UserRepository</span> <span
        class="keyword">extends</span> <span class="class">JpaRepository</span>&lt;<span
        class="class">User</span>, <span class="class">Long</span>&gt; {
    <span class="comment">// 1. Simple Native Query with Positional Parameter</span>
    <span class="annotation">@Query</span>(value = <span class="string">"SELECT * FROM users WHERE email = ?1"</span>, nativeQuery = <span
        class="keyword">true</span>)
    <span class="class">User</span> <span class="method">findByEmail</span>(<span class="class">String</span> <span
        class="var">email</span>);
    <span class="comment">// 2. Using Named Parameters</span>
    <span class="annotation">@Query</span>(value = <span class="string">"SELECT * FROM users WHERE name = :name"</span>, nativeQuery = <span
        class="keyword">true</span>)
    <span class="class">List</span>&lt;<span class="class">User</span>&gt; <span class="method">findByName</span>(<span
        class="annotation">@Param</span>(<span class="string">"name"</span>) <span class="class">String</span> <span
        class="var">name</span>);
    <span class="comment">// 3. Custom Result Set (select specific columns)</span>
    <span class="annotation">@Query</span>(value = <span
        class="string">"SELECT id, name FROM users WHERE age > :age"</span>, nativeQuery = <span
        class="keyword">true</span>)
    <span class="class">List</span>&lt;<span class="class">Object</span>[]&gt; <span class="method">findIdAndNameByAgeGreaterThan</span>(<span
        class="annotation">@Param</span>(<span class="string">"age"</span>) <span class="class">int</span> <span
        class="var">age</span>);
    <span class="comment">// 4. Update query using @Modifying</span>
    <span class="annotation">@Modifying</span>
    <span class="annotation">@Transactional</span>
    <span class="annotation">@Query</span>(value = <span
        class="string">"UPDATE users SET name = :name WHERE id = :id"</span>, nativeQuery = <span
        class="keyword">true</span>)
    <span class="class">int</span> <span class="method">updateUserName</span>(<span
        class="annotation">@Param</span>(<span class="string">"id"</span>) <span class="class">Long</span> <span
        class="var">id</span>, (<span class="annotation">@Param</span>(<span class="string">"name"</span>) <span
        class="class">String</span> <span class="var">name</span>);
}
</code>
</pre>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Point</th>
                <th>Description</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>nativeQuery = true</td>
                <td>Must be specified for raw SQL</td>
            </tr>
            <tr>
                <td>Column names</td>
                <td>Must match DB column names exactly</td>
            </tr>
            <tr>
                <td>Result</td>
                <td>Can map to entity or Object[]</td>
            </tr>
            <tr>
                <td>@Modifying</td>
                <td>Required for UPDATE, DELETE queries</td>
            </tr>
            <tr>
                <td>@Transactional</td>
                <td>Required for write operations</td>
            </tr>
            <tr>
                <td>Pagination</td>
                <td>Use `countQuery` along with `value` if paginating</td>
            </tr>
            </tbody>
        </table>
    </div>

    <ol>
        <li><strong>Collections Mapping Supported by JPA:</strong></li>
    </ol>

    <ul>
        <li>List, Set, Map, Collection.</li>
        <li>Requires @ElementCollection annotation over the collection variable.</li>
        <li>Creates a child table:
            <ul>
                <li>Set: Two columns (foreign key, element data).</li>
                <li>List/Map: Three columns (foreign key, index/key, element data).</li>
            </ul>
        </li>
    </ul>

    <hr>

    <h3>4. Enabling Spring Data JPA:</h3>

    <ul>
        <li>Auto-configured by adding spring-boot-starter-data-jpa dependency.</li>
        <li>Requires database connection and JPA details in application.properties</li>
        <li>(e.g., spring.datasource.*, spring.jpa.hibernate.ddl-auto, spring.jpa.show-sql,
            spring.jpa.database-platform).
        </li>
        <li>comparison between Spring Data's `CrudRepository`, `JpaRepository`, and `PagingAndSortingRepository`</li>
    </ul>

    <ol>
        <li><strong>CrudRepository</strong></li>
    </ol>

    <ul>
        <li><strong>Basic operations</strong> for CRUD (Create, Read, Update, Delete).</li>
        <li><strong>Parent interface</strong> for other repos.</li>
    </ul>

    <ul>
        <li><strong>Methods:</strong>
            <ul>
                <li>save(), saveAll(), findById(), findAll(), findAllById(), existsById(),</li>
                <li>count(), delete(), deleteById(), deleteAll()</li>
            </ul>
        </li>
    </ul>

    <ul>
        <li>No pagination or sorting support.</li>
    </ul>

    <ol start="2">
        <li>PagingAndSortingRepository (extends `CrudRepository` )</li>
    </ol>

    <ul>
        <li>Adds pagination &amp; sorting support.</li>
    </ul>

    <ul>
        <li>Methods:
            <ul>
                <li>findAll(Sort sort) // Sorting</li>
                <li>findAll(Pageable pageable) // Pagination + Sorting</li>
            </ul>
        </li>
    </ul>

    <ul>
        <li>Used when you need large dataset handling with pages.</li>
    </ul>

    <ol start="3">
        <li>JpaRepository (extends `PagingAndSortingRepository` )</li>
    </ol>

    <ul>
        <li>Most feature-rich (includes all methods from `CrudRepository` +
            PagingAndSortingRepository ).
        </li>
        <li>Adds batch operations &amp; JPA-specific methods.</li>
    </ul>

    <ul>
        <li>Methods:
            <ul>
                <li>flush(), saveAndFlush(), deleteInBatch(), deleteAllInBatch(), getOne()</li>
            </ul>
        </li>
    </ul>

    <ul>
        <li>Also provides `findAll()` with Sort/Pageable.</li>
        <li>Best for JPA/Hibernate projects.</li>
    </ul>

    <p><b>Key Differences Summary</b></p>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Feature</th>
                <th>CrudRepository</th>
                <th>PagingAndSortingRepository</th>
                <th>JpaRepository</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>Basic CRUD</td>
                <td>✔ Yes</td>
                <td>✔ Yes (inherits)</td>
                <td>✔ Yes (inherits)</td>
            </tr>
            <tr>
                <td>Pagination</td>
                <td>✕ No</td>
                <td>✔ Yes</td>
                <td>✔ Yes (inherits)</td>
            </tr>
            <tr>
                <td>Sorting</td>
                <td>✕ No</td>
                <td>✔ Yes</td>
                <td>✔ Yes (inherits)</td>
            </tr>
            <tr>
                <td>Batch Operations</td>
                <td>✕ No</td>
                <td>✕ No</td>
                <td>✔ Yes (deleteInBatch())</td>
            </tr>
            <tr>
                <td>JPA-Specific Methods</td>
                <td>✕ No</td>
                <td>✕ No</td>
                <td>✔ Yes (flush(), getOne())</td>
            </tr>
            </tbody>
        </table>
    </div>

    <p><strong>When to Use Which?</strong></p>

    <ul>
        <li><strong>CrudRepository</strong> → Simple CRUD operations (no pagination/sorting needed).</li>
        <li><strong>PagingAndSortingRepository</strong> → When dealing with large datasets requiring pagination/sorting.
        </li>
        <li><strong>JpaRepository</strong> → When using JPA/Hibernate and need advanced features (batch ops, flush(),
            etc.).
        </li>
    </ul>

    <hr>

    <h3>5. What is @Repository ?</h3>
    <p>@Repository is a <strong>Spring stereotype annotation</strong> used to indicate that the class is a <strong>DAO
        (Data Access Object)</strong> — a component responsible for interacting with the <strong>database</strong>.</p>

    <p>It is part of Spring's <strong>Component Scanning</strong> mechanism and also <strong>adds persistence-related
        exception translation.</strong>( DataAccessException )</p>

    <p>You use @Repository :</p>

    <ul>
        <li>In the <strong>persistence (DAO) layer</strong></li>
        <li>On classes that directly interact with the database</li>
        <li>In combination with Spring <strong>JPA</strong>, <strong>JDBC</strong>, <strong>Hibernate</strong>, etc.
        </li>
    </ul>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Reason</th>
                <th>Explanation</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><strong>Component Scanning</strong></td>
                <td>Spring auto-detects and registers it as a Bean</td>
            </tr>
            <tr>
                <td><strong>Exception Translation</strong></td>
                <td>Converts JDBC/Hibernate exceptions into Spring's DataAccessException</td>
            </tr>
            <tr>
                <td><strong>Semantic Clarity</strong></td>
                <td>Makes the code cleaner, separates responsibilities</td>
            </tr>
            <tr>
                <td><strong>Integration with Spring Data</strong></td>
                <td>Required for using `JpaRepository`, CrudRepository, etc.</td>
            </tr>
            </tbody>
        </table>
    </div>

    <p><b>Exception Translation Example</b></p>

    <p>Spring wraps SQL-related exceptions into <strong>unchecked</strong> exceptions like:</p>

    <pre class="java-code">
<code>
<span class="number">1</span> <span class="keyword">try</span> {
<span class="number">2</span> <span class="comment">// JDBC code</span>
<span class="number">3</span> } <span class="keyword">catch</span>(<span class="class">SQLException</span> <span
        class="var">ex</span>) {
<span class="number">4</span> <span class="keyword">throw new</span> <span
        class="class">DataAccessException</span>(<span class="var">ex</span>);
<span class="number">5</span> }
</code>
</pre>

    <p>This happens <strong>only if the class is marked with @Repository</strong>.</p>

    <hr>

    <h3>How to Use @Repository</h3>

    <p><b>1. Plain JDBC Repository</b></p>

    <pre class="java-code">
<code>
<span class="number">1</span> <span class="annotation">@Repository</span>
<span class="number">2</span> <span class="keyword">public class</span> <span class="class">UserDao</span> {
<span class="number">3</span>
<span class="number">4</span>     <span class="annotation">@Autowired</span>
<span class="number">5</span>     <span class="keyword">private</span> <span class="class">JdbcTemplate</span> <span
        class="var">jdbcTemplate</span>;
<span class="number">6</span>
<span class="number">7</span>     <span class="keyword">public</span> <span class="class">User</span> <span
        class="method">findById</span>(<span class="class">int</span> <span class="var">id</span>) {
<span class="number">8</span>         <span class="keyword">return</span> <span class="var">jdbcTemplate</span>.queryForObject(<span
        class="string">"SELECT * FROM user WHERE id = ?"</span>, <span class="keyword">new</span> <span class="class">Object</span>[] {<span
        class="var">id</span>}, <span class="keyword">new</span> <span class="class">UserRowMapper</span>());
<span class="number">9</span>     }
<span class="number">10</span> }
</code>
</pre>

    <p><b>2. Spring Data JPA Repository</b></p>

    <pre class="java-code">
<code>
<span class="number">1</span> <span class="annotation">@Repository</span>
<span class="number">2</span> <span class="keyword">public interface</span> <span
        class="class">UserRepository</span> <span class="keyword">extends</span> <span
        class="class">JpaRepository</span>&lt;<span class="class">User</span>, <span class="class">Long</span>&gt; {
<span class="number">3</span>     <span class="class">Optional</span>&lt;<span class="class">User</span>&gt; <span
        class="method">findByEmail</span>(<span class="class">String</span> <span class="var">email</span>);
<span class="number">4</span> }
</code>
</pre>

    <hr>

    <p>In Spring Data, @Repository is optional because Spring auto-adds it to interfaces extending JpaRepository, but
        you <strong>can add it explicitly for clarity or exception translation.</strong></p>

    <hr>

    <p><b>Best Practices</b></p>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Practice</th>
                <th>Why?</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>Always annotate DAO classes</td>
                <td>Enables exception translation</td>
            </tr>
            <tr>
                <td>Use interface + implementation</td>
                <td>Better for unit testing &amp; flexibility</td>
            </tr>
            <tr>
                <td>Keep repository logic thin</td>
                <td>Business logic belongs in services</td>
            </tr>
            </tbody>
        </table>
    </div>

    <p>Don't annotate @Service as
        @Repository</p>

    <p>Layers should be separated</p>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Summary</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>Feature</td>
                <td>@Repository</td>
            </tr>
            <tr>
                <td>Role</td>
                <td>Marks DAO/data-access class</td>
            </tr>
            <tr>
                <td>Spring Bean?</td>
                <td>Yes, registered via scanning</td>
            </tr>
            <tr>
                <td>Exception Translation</td>
                <td>✔ Yes</td>
            </tr>
            <tr>
                <td>Required for JPA Repos?</td>
                <td>Optional (auto-added), but useful</td>
            </tr>
            <tr>
                <td>Layer</td>
                <td>Persistence Layer</td>
            </tr>
            </tbody>
        </table>
    </div>
    <hr>
    <h3>6. JPA Relationships (Entity Associations)</h3>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Relationship Type</th>
                <th>Description</th>
                <th>Example</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>One-to-One</td>
                <td>One entity has exactly one related entity</td>
                <td>Person → Passport</td>
            </tr>
            <tr>
                <td>One-to-Many</td>
                <td>One entity has many related entities</td>
                <td>Department → Employees</td>
            </tr>
            <tr>
                <td>Many-to-One</td>
                <td>Many entities link to one entity</td>
                <td>Employees → Department</td>
            </tr>
            <tr>
                <td>Many-to-Many</td>
                <td>Many entities on both sides</td>
                <td>Student → Course</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Type</th>
                <th>Cardinality</th>
                <th>Annotations</th>
                <th>Table Structure</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>One-to-One</td>
                <td>1 → 1</td>
                <td>@OneToOne, @JoinColumn</td>
                <td>FK in either table</td>
            </tr>
            <tr>
                <td>One-to-Many</td>
                <td>1 → many</td>
                <td>@OneToMany, mappedBy</td>
                <td>FK in child table</td>
            </tr>
            <tr>
                <td>Many-to-One</td>
                <td>many → 1</td>
                <td>@ManyToOne, @JoinColumn</td>
                <td>FK in many side</td>
            </tr>
            <tr>
                <td>Many-to-Many</td>
                <td>many → many</td>
                <td>@ManyToMany, @JoinTable</td>
                <td>Extra join table</td>
            </tr>
            </tbody>
        </table>
    </div>

    <h3>1. One-to-One Relationship</h3>
    <p>Example: User → UserProfile</p>

    <pre class="java-code">
<code><span class="annotation">@Entity</span>
<span class="keyword">public class</span> <span class="class">User</span> {
  <span class="annotation">@Id</span> <span class="annotation">@GenerateValue</span>
  <span class="keyword">private</span> <span class="class">Long</span> id;
  <span class="keyword">private</span> <span class="class">String</span> name;

  <span class="annotation">@OneToOne</span>(cascade = <span class="class">CascadeType</span>.ALL)
  <span class="annotation">@JoinColumn</span>(name = <span class="string">"profile_id"</span>)
  <span class="keyword">private</span> <span class="class">UserProfile</span> profile;
}
</code>
</pre>

    <pre class="java-code">
<code><span class="annotation">@Entity</span>
<span class="keyword">public class</span> <span class="class">UserProfile</span> {
  <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
  <span class="keyword">private</span> <span class="class">Long</span> id;
  <span class="keyword">private</span> <span class="class">String</span> address;
}
</code>
</pre>

    <p>• @JoinColumn specifies the foreign key for owning side table only</p>
    <p>• specifies the foreign key column used to join two tables in a unidirectional or owning side of bidirectional
        relationships.</p>
    <p>• prevents the creation of a join table in bidirectional mapping.(On inverse side (non-owning in
        bidirectional))</p>

    <h3>2. One-to-Many Relationship</h3>
    <p>Example: Department → Employees</p>

    <pre class="java-code">
<code><span class="annotation">@Entity</span>
<span class="keyword">public class</span> <span class="class">Department</span> {
  <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
  <span class="keyword">private</span> <span class="class">Long</span> id;
  <span class="keyword">private</span> <span class="class">String</span> name;

  <span class="annotation">@OneToMany</span>(mappedBy = <span class="string">"department"</span>, cascade = <span
            class="class">CascadeType</span>.ALL)
  <span class="keyword">private</span> <span class="class">List</span>&lt;<span class="class">Employee</span>&gt; employees;
}
</code>
</pre>

    <pre class="java-code">
<code><span class="annotation">@Entity</span>
<span class="keyword">public class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
  <span class="keyword">private</span> <span class="class">Long</span> id;
  <span class="keyword">private</span> <span class="class">String</span> name;

  <span class="annotation">@ManyToOne</span>
  <span class="annotation">@JoinColumn</span>(name = <span class="string">"department_id"</span>)
  <span class="keyword">private</span> <span class="class">Department</span> department;
}
</code>
</pre>

    <p>• mappedBy is used to avoid creating a join table</p>
    <p>• Avoid CascadeType.REMOVE on the child side (may delete parent)</p>

    <h3>3. Many-to-One Relationship</h3>
    <p>Inverse of One-to-Many.</p>

    <pre class="java-code">
<code><span class="annotation">@ManyToOne</span>
<span class="annotation">@JoinColumn</span>(name = <span class="string">"dept_id"</span>)
<span class="keyword">private</span> <span class="class">Department</span> department;
</code>
</pre>

    <p>✔ Automatically handled when One-to-Many is properly mapped.</p>

    <hr>

    <h3>4. Many-to-Many Relationship</h3>
    <p>Example: Student -- Course</p>

    <pre class="java-code">
<code><span class="annotation">@Entity</span>
<span class="keyword">public class</span> <span class="class">Student</span> {
  <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
  <span class="keyword">private</span> <span class="class">Long</span> id;
  <span class="keyword">private</span> <span class="class">String</span> name;

  <span class="annotation">@ManyToMany</span>
  <span class="annotation">@JoinTable</span>(
    name = <span class="string">"student_course"</span>,
    joinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string">"student_id"</span>),
    inverseJoinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string">"course_id"</span>)
  )
  <span class="keyword">private</span> <span class="class">Set</span>&lt;<span class="class">Course</span>&gt; courses;
}
</code>
</pre>

    <pre class="java-code">
<code><span class="annotation">@Entity</span>
<span class="keyword">public class</span> <span class="class">Course</span> {
  <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
  <span class="keyword">private</span> <span class="class">Long</span> id;
  <span class="keyword">private</span> <span class="class">String</span> title;

  <span class="annotation">@ManyToMany</span>(mappedBy = <span class="string">"courses"</span>)
  <span class="keyword">private</span> <span class="class">Set</span>&lt;<span class="class">Student</span>&gt; students;
}
</code>
</pre>

    <p>🔍 Notes:</p>
    <p>• A join table is automatically created</p>
    <p>• Set preferred over List (no duplicates)</p>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Relationship</th>
                <th>Owning Side?</th>
                <th>@JoinColumn Required?</th>
                <th>Use mappedBy ?</th>
                <th>Default Fetch</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>OneToOne</td>
                <td>Either</td>
                <td>✔ Yes (if owning)</td>
                <td>✔ On inverse</td>
                <td>EAGER</td>
            </tr>
            <tr>
                <td>OneToMany</td>
                <td>No</td>
                <td>✘</td>
                <td>✔</td>
                <td>LAZY</td>
            </tr>
            <tr>
                <td>ManyToOne</td>
                <td>Yes</td>
                <td>✔</td>
                <td>✘</td>
                <td>EAGER</td>
            </tr>
            <tr>
                <td>ManyToMany</td>
                <td>Either with @JoinTable</td>
                <td></td>
                <td>✔ On inverse</td>
                <td>LAZY</td>
            </tr>
            </tbody>
        </table>
    </div>

    <p>• EAGER: Loads related entity immediately, can lead to performance issues or N+1 select problem</p>
    <p>• LAZY: Loads entity only when accessed, good for performance</p>
    <hr>
    <h3>7. Step-by-Step Setup for Two Databases Configuration</h3>
    <p>You'll configure:</p>
    <ul>
        <li>Two data sources</li>
        <li>Two entity managers</li>
        <li>Two transaction managers</li>
        <li>Two sets of entities and repositories</li>
    </ul>

    <pre class="code-block">
<code><span class="key">spring:</span>
  <span class="key">datasource:</span>
    <span class="key">primary:</span>
      <span class="key">url:</span> <span class="value">jdbc:mysql://localhost:3386/primary_db</span>
      <span class="key">username:</span> <span class="value">root</span>
      <span class="key">password:</span> <span class="value">password</span>
      <span class="key">driver-class-name:</span> <span class="value">com.mysql.cj.jdbc.Driver</span>

    <span class="key">secondary:</span>
      <span class="key">url:</span> <span class="value">jdbc:mysql://localhost:3386/secondary_db</span>
      <span class="key">username:</span> <span class="value">root</span>
      <span class="key">password:</span> <span class="value">password</span>
      <span class="key">driver-class-name:</span> <span class="value">com.mysql.cj.jdbc.Driver</span>

  <span class="key">jpa:</span>
    <span class="key">hibernate:</span>
      <span class="key">ddl-auto:</span> <span class="value">update</span>
      <span class="key">show-sql:</span> <span class="value">true</span>
</code>
</pre>

    <p><b>PrimaryDBConfig.java</b></p>
    <pre class="java-code">
<code><span class="annotation">@Configuration</span>
<span class="annotation">@EnableTransactionManagement</span>
<span class="annotation">@EnableJpaRepositories</span>(
  basePackages = <span class="string">"com.example.primary.repository"</span>,
  entityManagerFactoryRef = <span class="string">"primaryEntityManagerFactory"</span>,
  transactionManagerRef = <span class="string">"primaryTransactionManager"</span>
)
<span class="keyword">public class</span> <span class="class">PrimaryDBConfig</span> {

  <span class="annotation">@Primary</span>
  <span class="annotation">@Bean</span>
  <span class="annotation">@ConfigurationProperties</span>(<span class="string">"spring.datasource.primary"</span>)
  <span class="keyword">public</span> <span class="class">DataSourceProperties</span> <span class="method">primaryDataSourceProps</span>() {
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">DataSourceProperties</span>();
  }

  <span class="annotation">@Primary</span>
  <span class="annotation">@Bean</span>
  <span class="keyword">public</span> <span class="class">DataSource</span> <span
            class="method">primaryDataSource</span>() {
    <span class="keyword">return</span> primaryDataSourceProps().initializeDataSourceBuilder().build();
  }

  <span class="annotation">@Primary</span>
  <span class="annotation">@Bean</span>
  <span class="keyword">public</span> <span class="class">LocalContainerEntityManagerFactoryBean</span> <span
            class="method">primaryEntityManagerFactory</span>(
    <span class="class">EntityManagerFactoryBuilder</span> builder
  ) {
    <span class="keyword">return</span> builder
      .dataSource(primaryDataSource())
      .packages(<span class="string">"com.example.primary.entity"</span>)
      .persistenceUnit(<span class="string">"primary"</span>)
      .build();
  }

  <span class="annotation">@Primary</span>
  <span class="annotation">@Bean</span>
  <span class="keyword">public</span> <span class="class">PlatformTransactionManager</span> <span class="method">primaryTransactionManager</span>(
    <span class="annotation">@Qualifier</span>(<span class="string">"primaryEntityManagerFactory"</span>) <span
            class="class">EntityManagerFactory</span> emf
  ) {
    <span class="keyword">return</span> <span class="keyword">new</span> <span
            class="class">JpaTransactionManager</span>(emf);
  }
}
</code>
</pre>

    <p><b>SecondaryDBConfig.java</b></p>
    <pre class="java-code">
<code><span class="annotation">@Configuration</span>
<span class="annotation">@EnableTransactionManagement</span>
<span class="annotation">@EnableJpaRepositoryies</span>(
  basePackages = <span class="string">"com.example.secondary.repository"</span>,
  entityManagerFactoryRef = <span class="string">"secondaryEntityManagerFactory"</span>,
  transactionManagerRef = <span class="string">"secondaryTransactionManager"</span>
)
<span class="keyword">public class</span> <span class="class">SecondaryDBConfig</span> {

  <span class="annotation">@Bean</span>
  <span class="annotation">@ConfigurationProperties</span>(<span class="string">"spring.datasource.secondary"</span>)
  <span class="keyword">public</span> <span class="class">DataSourceProperties</span> <span class="method">secondaryDataSourceProps</span>() {
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">DataSourceProperties</span>();
  }

  <span class="annotation">@Bean</span>
  <span class="keyword">public</span> <span class="class">DataSource</span> <span
            class="method">secondaryDataSource</span>() {
    <span class="keyword">return</span> secondaryDataSourceProps().initializeDataSourceBuilder().build();
  }

  <span class="annotation">@Bean</span>
  <span class="keyword">public</span> <span class="class">LocalContainerEntityManagerFactoryBean</span> <span
            class="method">secondaryEntityManagerFactory</span>(
    <span class="class">EntityManagerFactoryBuilder</span> builder
  ) {
    <span class="keyword">return</span> builder
      .dataSource(secondaryDataSource())
      .packages(<span class="string">"com.example.secondary.entity"</span>)
      .persistenceUnit(<span class="string">"secondary"</span>)
      .build();
  }

  <span class="annotation">@Bean</span>
  <span class="keyword">public</span> <span class="class">PlatformTransactionManager</span> <span class="method">secondaryTransactionManager</span>(
    <span class="annotation">@Qualifier</span>(<span class="string">"secondaryEntityManagerFactory"</span>) <span
            class="class">EntityManagerFactory</span> emf
  ) {
    <span class="keyword">return</span> <span class="keyword">new</span> <span
            class="class">JpaTransactionManager</span>(emf);
  }
}
</code>
</pre>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Component</th>
                <th>Primary DB</th>
                <th>Secondary DB</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>Entities</td>
                <td>com.example.primary</td>
                <td>com.example.secondary.entity</td>
            </tr>
            <tr>
                <td>Repositories</td>
                <td>com.example.primary</td>
                <td>com.example.secondary.repository</td>
            </tr>
            <tr>
                <td>DataSource</td>
                <td>primaryDataSource()</td>
                <td>secondaryDataSource()</td>
            </tr>
            <tr>
                <td>EntityManagerFactory</td>
                <td>primaryEntityManagerFactory()</td>
                <td>secondaryEntityManagerFactory()</td>
            </tr>
            <tr>
                <td>TransactionManager</td>
                <td>primaryTransactionManager()</td>
                <td>secondaryTransactionManager()</td>
            </tr>
            </tbody>
        </table>
    </div>
    <hr>
    <h3>8. Spring Data JPA repository method types</h3>

    <p>Let's go through each category of Spring Data JPA repository method types and explain them with simple examples,
        using an imaginary User entity:</p>

    <p>❌ Sample Entity for Reference:</p>

    <pre class="java-code">
<code><span class="annotation">@Entity</span>
<span class="keyword">public class</span> <span class="class">User</span> {
   <span class="annotation">@Id</span>
   <span class="keyword">private</span> <span class="class">Long</span> id;
   <span class="keyword">private</span> <span class="class">String</span> name;
   <span class="keyword">private</span> <span class="keyword">int</span> age;
   <span class="keyword">private</span> <span class="keyword">double</span> salary;
   <span class="keyword">private</span> <span class="keyword">float</span> rating;
   <span class="keyword">private</span> <span class="keyword">boolean</span> active;
   <span class="keyword">private</span> <span class="keyword">char</span> grade;
   <span class="keyword">private</span> <span class="class">LocalDate</span> createdDate;
}</code>
</pre>

    <h3>✅ 1. Basic Equality Methods</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;();
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">Is</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">Equals</span>()</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Find records where a field equals a given value.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByAge</span>(<span class="keyword">int</span> <span class="var">age</span>); <span class="comment">// where age = ?</span>
<span class="method">findByAgeIs</span>(<span class="keyword">int</span> <span class="var">age</span>); <span class="comment">// same as above</span>
<span class="method">findByAgeEquals</span>(<span class="keyword">int</span> <span class="var">age</span>); <span class="comment">// same as above</span></code>
</pre>

    <h3>✅ 2. Negative Condition Methods</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">Not</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">IsNot</span>()</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Find records where a field does not equal a given value.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByGradeNot</span>(<span class="keyword">char</span> <span class="var">grade</span>);    <span class="comment">// where grade != ?</span>
<span class="method">findByActiveIsNot</span>(<span class="keyword">boolean</span> <span class="var">active</span>);    <span class="comment">// where active != ?</span></code>
</pre>

    <h3>✔ 3. Comparison Methods</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">GreaterThan</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">GreaterThanEqual</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">LessThan</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">LessThanEqual</span>()</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Find records where a field value is greater/less than a specific value.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByAgeGreaterThan</span>(<span class="keyword">int</span> <span class="var">age</span>);    <span class="comment">// where age > ?</span>
<span class="method">findBySalaryLessThanEqual</span>(<span class="keyword">double</span> <span class="var">salary</span>);    <span class="comment">// where salary <= ?</span></code>
</pre>

    <h3>✔ 4. Between Range</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">Between</span>(<span class="var">value1</span>, <span class="var">value2</span>)</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Get values between two given values, inclusive.</p>

    <p><strong>Example:</strong></p>

    <pre class="java-code">
<code><span class="method">findByAgeBetween</span>(<span class="keyword">int</span> <span class="var">min</span>, <span class="keyword">int</span> <span class="var">max</span>);    <span class="comment">// where age BETWEEN ? AND ?</span></code>
</pre>

    <h3>✔ 5. IN and NOT IN</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">In</span>(<span class="class">Collection</span>&lt;?&gt; <span class="var">list</span>)
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">NotIn</span>(<span class="class">Collection</span>&lt;?&gt; <span class="var">list</span>)</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Check if the field value is in/not in a list.</p>

    <p><strong>Example:</strong></p>

    <pre class="java-code">
<code><span class="method">findByAgeIn</span>(<span class="class">List</span>&lt;<span class="class">Integer</span>&gt; <span class="var">ages</span>);    <span class="comment">// where age in (?, ?, ?)</span>
<span class="method">findByGradeNotIn</span>(<span class="class">List</span>&lt;<span class="class">Character</span>&gt; <span class="var">grades</span>); <span class="comment">// where grade NOT IN (?, ?)</span></code>
</pre>

    <h3>6. NULL Checks</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">IsNull</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">IsNotNull</span>()</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Filter by null or not null values.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByNameIsNull</span>();    <span class="comment">// where name is null</span>
<span class="method">findByRatingIsNotNull</span>();    <span class="comment">// where rating is not null</span></code>
</pre>

    <h3>7. Boolean Methods</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">True</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">False</span>()</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Used for boolean or Boolean fields.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByActiveTrue</span>();    <span class="comment">// where active = true</span>
<span class="method">findByActiveFalse</span>();    <span class="comment">// where active = false</span></code>
</pre>

    <h3>8. String Matching (for String fields)</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">Containing</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">Startswith</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">EndsWith</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">Like</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">IgnoreCase</span>()</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Perform flexible text matching.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByNameContaining</span>(<span class="class">String</span> <span class="var">s</span>);    <span class="comment">// where name LIKE %s%</span>
<span class="method">findByNameStartswith</span>(<span class="class">String</span> <span class="var">s</span>);    <span class="comment">// where name LIKE s%</span>
<span class="method">findByNameLike</span>(<span class="class">String</span> <span class="var">s</span>);    <span class="comment">// where name LIKE ?</span>
<span class="method">findByNameIgnoreCase</span>(<span class="class">String</span> <span class="var">s</span>);    <span class="comment">// where LOWER(name) = LOWER(?)</span></code>
</pre>

    <h3>✔ 9. Combining Multiple Fields</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field1</span>&gt;<span class="method">And</span>&lt;<span class="class">Field2</span>&gt;();
<span class="method">findBy</span>&lt;<span class="class">Field1</span>&gt;<span class="method">Or</span>&lt;<span class="class">Field2</span>&gt;</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Add multiple conditions using AND / OR.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByAgeAndActive</span>(<span class="keyword">int</span> <span class="var">age</span>, <span class="keyword">boolean</span> <span class="var">active</span>);   <span class="comment">// where age = ? AND active = ?</span>
<span class="method">findBySalaryOrRatingGreaterThan</span>(<span class="keyword">double</span> <span class="var">s</span>, <span class="keyword">float</span> <span class="var">r</span>); <span class="comment">// salary = ? OR rating > ?</span></code>
</pre>

    <h3>✔ 10. Sorting with Method Name</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">OrderBy</span>&lt;<span class="class">OtherField</span>&gt;<span class="method">Asc</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">OrderBy</span>&lt;<span class="class">OtherField</span>&gt;<span class="method">Desc</span>()</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Add ordering to the result.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByAgeOrderByNameAsc</span>();    <span class="comment">// where age = ? ORDER BY name ASC</span>
<span class="method">findBySalaryOrderByRatingDesc</span>(); <span class="comment">// where salary = ? ORDER BY rating DESC</span></code>
</pre>

    <h3>✔ 11. Pagination with Pageable</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;(. . . , <span class="class">Pageable</span> <span class="var">pageable</span>)</code>
</pre>

    <p><strong>Meaning:</strong></p>

    <p>Return a Page&lt;T&gt; or Slice&lt;T&gt; of results.</p>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="class">Page</span>&lt;<span class="class">User</span>&gt; <span class="method">findByAgeGreaterThan</span>(<span class="keyword">int</span> <span class="var">age</span>, <span class="class">Pageable</span> <span class="var">pageable</span>);
<span class="class">Slice</span>&lt;<span class="class">User</span>&gt; <span class="method">findBySalaryBetween</span>(<span class="keyword">double</span> <span class="var">min</span>, <span class="keyword">double</span> <span class="var">max</span>, <span class="class">Pageable</span> <span class="var">pageable</span>);</code>
</pre>

    <h3>12. Date & Time Filters</h3>

    <p><strong>Syntax:</strong></p>

    <pre class="java-code">
<code><span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">After</span>()
<span class="method">findBy</span>&lt;<span class="class">Field</span>&gt;<span class="method">Before</span>()</code>
</pre>

    <p><strong>Examples:</strong></p>

    <pre class="java-code">
<code><span class="method">findByCreatedDateAfter</span>(<span class="class">LocalDate</span> <span class="var">date</span>); <span class="comment">// where createdDate > ?</span>
<span class="method">findByCreatedDateBetween</span>(<span class="class">LocalDate</span> <span class="var">d1</span>, <span class="class">LocalDate</span> <span class="var">d2</span>); <span class="comment">// between</span></code>
</pre>

    <h3>Summary Table (Quick Reference)</h3>

    <div class="table-container">
        <table class="basic-table">
            <thead>
            <tr>
                <th>Method</th>
                <th>Description</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>findByX()</td>
                <td>Equals</td>
            </tr>
            <tr>
                <td>findByXIsNot()</td>
                <td>Not equal</td>
            </tr>
            <tr>
                <td>findByXGreaterThan()</td>
                <td>&gt;</td>
            </tr>
            <tr>
                <td>findByXLessThan()</td>
                <td>&lt;</td>
            </tr>
            <tr>
                <td>findByXBetween()</td>
                <td>Range</td>
            </tr>
            <tr>
                <td>findByXIn()</td>
                <td>In list</td>
            </tr>
            <tr>
                <td>findByXIsNull()</td>
                <td>Null</td>
            </tr>
            <tr>
                <td>findByActiveTrue()</td>
                <td>Boolean check</td>
            </tr>
            <tr>
                <td>findByNameContaining()</td>
                <td>LIKE %value%</td>
            </tr>
            <tr>
                <td>findByNameStartsWith()</td>
                <td>LIKE value%</td>
            </tr>
            <tr>
                <td>findByXOrderByYAsc()</td>
                <td>Sort</td>
            </tr>
            <tr>
                <td>Page
                    <User> findByX(..., Pageable)
                </td>
                <td>Pagination</td>
            </tr>
            </tbody>
        </table>
    </div>
    <br>
    <hr>
    <br>
    <div class="card-footer">
        <ul class="pagination justify-content-center">
            <li class="page-item"><a class="page-link btn-outline-primary"
                                     href="../spring/transactions.html">&lArr; Previous</a></li>
            <li class="page-item"><a class="page-link" href="../spring/jpa2.html">Next
                &rArr;</a></li>
        </ul>
    </div>
</main>

<!-- Scripts -->
<script src="../js/sidebar.js"></script>
<script src="../js/componentLoader.js"></script>
</body>
</html>